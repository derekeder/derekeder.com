<h2>
  <small>29 Oct 2012<br /></small>
  Hello World! Setting up a Jekyll blog inside Sinatra
</h2>
<p><a href='http://jekyllrb.com'><img class='img-polaroid' src='http://derekeder.com/images/blog/jekyll.jpg' title='Jekyll' alt='Jekyll'></a> + <a href='http://sinatrarb.com'><img class='img-polaroid' src='http://derekeder.com/images/blog/sinatra.jpg' title='Sinatra' alt='Sinatra'></a></p>

<p>I'm going meta on my first blog post: how to set up a <a href="http://jekyllrb.com/">Jekyll</a> blog inside a <a href="http://www.sinatrarb.com/">Sinatra</a> app. A <a href="http://recursive-design.com/blog/2010/10/12/static-blogging-the-jekyll-way/">few</a> <a href="http://mikeferrier.com/2011/04/29/blogging-with-jekyll-haml-sass-and-jammit/">people</a> have <a href="http://danielmcgraw.com/2011/04/14/The-Ultimate-Guide-To-Getting-Started-With-Jekyll-Part-1/">written</a> on this <a href="http://www.engineyard.com/blog/2012/introducing-bloggy-a-simple-way-to-add-a-jekyll-blog-to-any-rails-application/">topic</a>, but I had some specific requirements that no one addressed. So my goal here is to write the post I wish existed when I started out. Here it goes.</p>

<p>My existing site is written in Ruby with the <a href="http://www.sinatrarb.com/">Sinatra</a> web framework. I don't want Jekyll to take over my whole application, rather just a certain part of it (the <a href="/blog">/blog</a> section). Thankfully, this is possible AND I can reuse my layout.haml (header, footer, styles, etc) for the blog pages. Here's how:</p>

<h3>Installing Jekyll</h3>

<p>First, you gotta install some stuff. I'll assume you are using <a href="http://gembundler.com/">Bundler</a> to handle your gems, because you should be.</p>

<div class="highlight"><pre><code class="bash"><span class="c"># add to your Gemfile</span>
gem <span class="s1">&#39;jekyll&#39;</span>
gem <span class="s1">&#39;rdiscount&#39;</span> <span class="c"># for markdown support</span>
</code></pre>
</div>


<p>Next, you will need to clone some basic setup files for Jekyll to a folder within your site. Daniel McGraw has a nice little <a href="https://github.com/danielmcgraw/Jekyll-Base">Jekyll Base</a> to get you started.</p>

<div class="highlight"><pre><code class="bash"><span class="c"># from within your Sinatra app lib/[your-app]/ folder</span>
git clone git@github.com:danielmcgraw/Jekyll-Base.git jekyll_blog
</code></pre>
</div>


<p>We will add these files to our primary git repo, so you can remove the .git folder that is generated when you clone Jekyll-Base. Keeping it will cause git to assume its a submodule, and your files won't be added.</p>

<div class="highlight"><pre><code class="bash"><span class="nb">cd </span>jekyll_blog
rm -rf .git
</code></pre>
</div>


<p>You should also check out _config.yml. It has all of your <a href="https://github.com/mojombo/jekyll/wiki/Configuration">Jekyll configuration</a>, which is worth understanding to get the most out of it. Once you get it configured, go ahead and run Jekyll for the first time to generate your static pages in to _site for the first time.</p>

<div class="highlight"><pre><code class="bash">Jekyll
</code></pre>
</div>


<p>Jekyll also offers a built in web server for local development, but we shouldn't need it with our Sinatra app. Once Jekyll generates our pages in _site, we can kill the process.</p>

<p><strong>Note</strong> that whenever you make <strong>any</strong> change to your Jekyll files, including writing new posts, you will have to run the Jekyll command to re-generate your static files.</p>

<h3>Set up your routes</h3>

<p>Next, we need to wire up our routes. In my case, I want Jekyll to handle everything under /blog.</p>

<div class="highlight"><pre><code class="ruby"><span class="c1"># in application.rb</span>
<span class="n">get</span> <span class="s2">&quot;/blog/?*&quot;</span> <span class="k">do</span>
  <span class="n">jekyll_blog</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="p">{</span><span class="mi">404</span><span class="p">}</span>
<span class="k">end</span>
</code></pre>
</div>


<p>Next, create a method to route our page requests correctly to Jekyll. Basically what I'm doing here is looking up the blog post file based on the URL, reading the file in to a string, and rendering that string like I would any .erb page.</p>

<div class="highlight"><pre><code class="ruby"> 
<span class="k">def</span> <span class="nf">jekyll_blog</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">missing_file_block</span><span class="p">)</span>
  <span class="vi">@current_menu</span> <span class="o">=</span> <span class="s2">&quot;blog&quot;</span>
  <span class="vi">@title</span> <span class="o">=</span> <span class="s2">&quot;Blog - Derek Eder&quot;</span>

  <span class="n">file_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">),</span> <span class="s1">&#39;jekyll_blog/_site&#39;</span><span class="p">,</span>  <span class="n">path</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
  <span class="n">file_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">)</span> <span class="k">unless</span> <span class="n">file_path</span> <span class="o">=~</span> <span class="sr">/\.[a-z]+$/i</span>  

  <span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span>
    <span class="n">file</span><span class="o">.</span><span class="n">close</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">file_path</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="n">file_path</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">&#39;.css&#39;</span><span class="p">))</span>
      <span class="n">erb</span> <span class="n">contents</span><span class="p">,</span> <span class="ss">:content_type</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/xml&#39;</span>
    <span class="k">else</span>
      <span class="n">erb</span> <span class="n">contents</span><span class="p">,</span> <span class="ss">:layout_engine</span> <span class="o">=&gt;</span> <span class="ss">:haml</span>
    <span class="k">end</span>
  <span class="k">else</span>
    <span class="n">haml</span> <span class="ss">:not_found</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>


<p>We should now be ready to test this out. Go ahead an fire up your local webserver. I prefer <a href="http://unicorn.bogomips.org/">Unicorn</a>.</p>

<div class="highlight"><pre><code class="bash">unicorn
<span class="c"># navigate to http://localhost:8080/blog</span>
</code></pre>
</div>


<p>At this point, you should be up and running with the a basic Jekyll blog within your app. You can start writing posts now, or if you want to add more bells and whistles, read on.</p>

<h3>Add some fancy features</h3>

<p>Jekyll supports <a href="http://daringfireball.net/projects/markdown/">Markdown</a>, which is a pretty robust and simple way to write content for the web. However, it doesn't do everything for you. I also wanted to add commenting, sharing and code syntax highlighting.</p>

<h4>Commenting</h4>

<p><a href="http://disqus.com/">Disqus</a> is my choice for this. They offer a commenting service for free, have login integration with Twitter and other 3rd party apps and have great moderation tools. To wire it up to Jekyll, create a Disqus account and add this block of code (with your Disqus site ID) to _post.html in the _layouts folder.</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;disqus_thread&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
    <span class="cm">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */</span>
    <span class="kd">var</span> <span class="nx">disqus_shortname</span> <span class="o">=</span> <span class="s1">&#39;your-site-name&#39;</span><span class="p">;</span> <span class="c1">// required: replace example with your forum shortname</span>
  <span class="kd">var</span> <span class="nx">disqus_identifier</span> <span class="o">=</span> <span class="s1">&#39;/hello-world-setting-up-a-jekyll-blog-in-sinatra&#39;</span><span class="p">;</span>
    <span class="cm">/* * * DON&#39;T EDIT BELOW THIS LINE * * */</span>
    <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">dsq</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span> <span class="nx">dsq</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;text/javascript&#39;</span><span class="p">;</span> <span class="nx">dsq</span><span class="p">.</span><span class="nx">async</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">dsq</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s1">&#39;http://&#39;</span> <span class="o">+</span> <span class="nx">disqus_shortname</span> <span class="o">+</span> <span class="s1">&#39;.disqus.com/embed.js&#39;</span><span class="p">;</span>
        <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">dsq</span><span class="p">);</span>
    <span class="p">})();</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;noscript&gt;</span>Please enable JavaScript to view the <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://disqus.com/?ref_noscript&quot;</span><span class="nt">&gt;</span>comments powered by Disqus.<span class="nt">&lt;/a&gt;&lt;/noscript&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://disqus.com&quot;</span> <span class="na">class=</span><span class="s">&quot;dsq-brlink&quot;</span><span class="nt">&gt;</span>blog comments powered by <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;logo-disqus&quot;</span><span class="nt">&gt;</span>Disqus<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>
</code></pre>
</div>


<h4>Sharing</h4>

<p>Social media! Everyone loves it. An easy way to offer sharing links for your posts is by using a service called <a href="http://www.addthis.com/">AddThis</a>. Like Disqus, they are free. In fact, you don't even need to create an account with them to get started. Just <a href="https://www.addthis.com/get/sharing">grab the code</a> and place it in your _post.html file like we did with Disqus.</p>

<div class="highlight"><pre><code class="html"><span class="c">&lt;!-- AddThis Button BEGIN --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;addthis_toolbox addthis_default_style &quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;addthis_button_tweet&quot;</span><span class="nt">&gt;&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;addthis_button_facebook_like&quot;</span> <span class="na">fb:like:layout=</span><span class="s">&quot;button_count&quot;</span><span class="nt">&gt;&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;http://s7.addthis.com/js/300/addthis_widget.js#pubid=xa-508f02450809cc4d&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="c">&lt;!-- AddThis Button END --&gt;</span>
</code></pre>
</div>


<h4>Syntax highlighting</h4>

<p>I like sharing code (like I'm doing in this post), and its important for readability to do syntax highlighting. Jekyll supports this via a Python library called <a href="http://pygments.org/">Pygments</a>.</p>

<p>In our Jekyll config, enable pygments.</p>

<div class="highlight"><pre><code class="ruby"><span class="n">pygments</span><span class="p">:</span> <span class="kp">true</span>
</code></pre>
</div>


<p>Then we install Pygments and use it to generate our CSS.</p>

<div class="highlight"><pre><code class="bash">sudo easy_install pygments
pygmentize -S default -f html &gt; code_highlighting.css
</code></pre>
</div>


<p>I added this css file to my public/stylesheets/ folder and reference in my site header.</p>

<div class="highlight"><pre><code class="bash">&lt;link <span class="nv">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;/stylesheets/code_highlighting.css&quot;</span>/&gt;
</code></pre>
</div>


<p>Then, regenerate Jekyll.</p>

<h4>RSS, pagination and images</h4>

<p>Scott Parker has a <a href="http://spparker.com/posts/2011-04-26-keeping-jekyll-classy">great little tutorial</a> for adding additional features that don't come out of the box with Jekyll, namely RSS, pagination and convenient image handling. I definitely recommend checking it out.</p>

<h3>Moar code!</h3>

<p>If you want to see all of these parts in action together, <a href="https://github.com/derekeder/derekeder.com/tree/master/lib/site_template/jekyll_blog">check out the code for this site on Github</a>.</p>

<p>Happy blogging!</p>


<hr />
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_tweet"></a>
<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
</div>
<script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=xa-508f02450809cc4d"></script>
<!-- AddThis Button END -->

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'derekeder'; // required: replace example with your forum shortname
  var disqus_identifier = '/hello-world-setting-up-a-jekyll-blog-in-sinatra';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
<hr />

<p><a href='/'>&laquo; back to blog</a></p>